<!DOCTYPE html>
<html>
<head>
  <%- include('./includes/head'); %>
</head>
<body>
  <div class="wrapper">
    <div id="modal-overlay"></div>
    <div id="log-time-modal" class="card modal middle width-50">
      <form id="log-time-form" action="/issues/<%= locals.issue.id %>/log" method="POST">
        <h1 class="title">Log Time</h1>
        <table class="full-width">
          <colgroup>
            <col class="width-15"></col>
            <col></col>
            <col class="width-12"></col>
          </colgroup>
          <tbody>
            <tr>
              <td><label for="time">Estimate:</label></td>
              <td><input id="time" class="full-width" type="text" name="time" placeholder="3w 2d 4h 30m"></td>
              <td class="text-right">
                <button>
                  <%- include('includes/icon', { icon: 'done' }); %>  
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </form>
    </div>

    <div class="header">
      <%- include('./includes/navbar', { active: 'issues' }); %>
    </div>
    <div class="content">
      <div class="card full-width marg-bottom-5">
        <table class="full-width">
          <tbody>
            <tr>
              <td>
                <b><%= locals.issue.id + ' - ' %></b><div class="italic inline"><%= locals.issue.state %></div>
              </td>
              <td class="text-right">
                <form action="/issues/<%= locals.issue.id %>/toggleProgress" method="POST">
                  <button id="toggle-progress-btn" <%= locals.issue.state === 'Closed' ? 'disabled' : ''%>><%= locals.issue.state === 'Awaiting Start' || locals.issue.state === 'Resolved' || locals.issue.state === 'Closed' ? 'Start' : 'Stop' %> Progress</button>
                </form>
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <b><%= locals.issue.title %></b>
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <textarea class="full-width" rows="6" name="description" disabled><%= locals.issue.description %></textarea>
              </td>
            </tr>
            <tr>
              <td>
                <button id="log-time-btn" <%= locals.issue.state === 'In Progress' ? '' : 'disabled' %>>
                  <%- include('includes/icon', { icon: 'access_time' }); %>
                </button>
              </td>
              <td>
                <div id="time-graph">
                  <%- include('includes/time-graph', {
                    estimate: locals.issue.estimate,
                    total: locals.issue.totalSeconds,
                    friendlyEstimate: locals.issue.friendlyEstimate,
                    friendlyTotal: locals.issue.friendlyTotal
                  }); %>
                </div>
              </td>
            </tr>
            <tr>
              <td>
                <form action="/issues/<%= locals.issue.id %>/<%= locals.issue.state === 'Resolved' ? 'close' : 'resolve' %>" method="POST">
                  <button id="resolve-btn" <%= locals.issue.state === 'Closed' ? 'disabled' : '' %>><%= locals.issue.state === 'Resolved' || locals.issue.state === 'Closed' ? 'Close' : 'Resolved' %></button>
                </form>
              </td>
              <td class="text-right">
                <form action="/issues" method="GET">
                  <button id="done-btn">
                    <%- include('includes/icon', { icon: 'done' }); %>
                  </button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="list-wrapper">
        <% for (let workLog of issue.workLogs) { %>
          <div class="list-item">
            <table class="full-width">
              <tbody>
                <tr>
                  <td class="text-right">
                    <%= workLog.friendlyTime %>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</body>
</html>
